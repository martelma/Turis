<ng-keyboard-shortcuts [shortcuts]="globalShortcutsService.shortcuts$ | async"></ng-keyboard-shortcuts>

<!-- Main Content with Drawer Container -->
<mat-drawer-container class="flex-auto h-full">
    <!-- Main Content -->
    <mat-drawer-content class="flex flex-col h-full">
        <div class="grid grid-cols-1 gap-6 w-full min-w-0 h-full min-h-0">
            <div class="flex flex-col flex-auto bg-card shadow rounded-2xl overflow-hidden p-6 h-full min-h-0">
                <div class="grid grid-cols-1 lg:grid-cols-10 gap-6 h-full min-h-0">
                    <!-- Calendar Badges - Left Side (30%) -->
                    <div class="lg:col-span-3">
                        <app-calendar-badges
                            [startDate]="startDate"
                            [events]="calendarEvents"
                            [selectedDate]="currentCalendarDate"
                            (dateSelected)="onDateSelected($event)"
                            (viewChanged)="onCalendarViewChanged($event)"></app-calendar-badges>
                    </div>

                    <!-- Services List - Right Side (70%) -->
                    <div class="lg:col-span-7 flex flex-col w-full">
                        <div class="flex items-start space-x-3 mb-4">
                            <mat-icon class="icon-size-12 mt-1" [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                            <div class="flex flex-col">
                                <h2 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-tight">
                                    {{ 'Navigation.Calendar' | transloco }}
                                </h2>
                                <span class="text-sm text-secondary mt-1">
                                    {{ currentCalendarDate | date: 'EEE d MMMM y' : 'UTC' : 'it-IT' | titlecase }}
                                    <span class="font-semibold">[{{ services?.length ?? 0 }}]</span>
                                </span>
                            </div>
                        </div>

                        <!-- Services Table -->
                        <div class="flex flex-col flex-auto overflow-hidden w-full">
                            <div class="overflow-x-auto w-full">
                                <table class="w-full bg-transparent" mat-table [dataSource]="services">
                                    <ng-container matColumnDef="date">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'Service.Date' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.date | date: 'dd/MM/yyyy - HH:mm' : 'UTC' : 'it-IT' }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="people">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'Service.People' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.people }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="languages">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'General.Languages' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <span
                                                *ngFor="let lang of element?.languages"
                                                [matTooltip]="lang"
                                                class="mr-2"
                                                [ngClass]="
                                                    'fi fi-' + ((lang | lowercase) === 'en' ? 'gb' : (lang | lowercase))
                                                "></span>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="location">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'Service.Location' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="flex flex-col">
                                                <span>{{ element.location }}</span>
                                                <span>{{ element.meetingPlace }}</span>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="serviceType">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'Service.ServiceType' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            <div class="flex flex-col">
                                                <span>{{ element.serviceType }}</span>
                                                <span>{{ element.durationType }}</span>
                                            </div>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="client">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'General.Client' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.client?.fullName }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="title">
                                        <th mat-header-cell *matHeaderCellDef>
                                            {{ 'Service.Title' | transloco }}
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{ element.title }}
                                        </td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr
                                        mat-row
                                        *matRowDef="let row; columns: displayedColumns"
                                        class="hover:bg-gray-100 dark:hover:bg-hover cursor-pointer"
                                        (click)="selectedService(row)"></tr>
                                </table>
                            </div>

                            <!-- Loading indicator -->
                            <div *ngIf="loading" class="flex items-center justify-center p-8">
                                <mat-spinner [diameter]="40"></mat-spinner>
                            </div>

                            <!-- Empty state -->
                            <div
                                *ngIf="!loading && services?.length === 0"
                                class="flex flex-col items-center justify-center p-8 text-center">
                                <mat-icon
                                    class="icon-size-24 text-hint"
                                    [svgIcon]="'heroicons_outline:calendar'"></mat-icon>
                                <p class="mt-4 text-lg font-medium text-secondary">Nessun servizio trovato</p>
                                <p class="text-sm text-hint">Seleziona una data dal calendario</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer-content>

    <!-- Details Drawer -->
    <mat-drawer
        #detailsDrawer
        class="w-full md:w-160 dark:bg-gray-900"
        [mode]="drawerDetailMode"
        [position]="'end'"
        [opened]="false"
        (openedChange)="drawerDetailsChanged($event)">
        <app-calendar-detail [service]="currentService" (closeDrawer)="closeDrawer()"></app-calendar-detail>
    </mat-drawer>
</mat-drawer-container>
