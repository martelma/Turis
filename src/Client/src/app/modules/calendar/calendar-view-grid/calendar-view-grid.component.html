<ng-keyboard-shortcuts [shortcuts]="globalShortcutsService.shortcuts$ | async"></ng-keyboard-shortcuts>
<div class="flex flex-1 h-full w-full">
    <app-calendar-selector
        #calendarSelector
        [date]="currentDate"
        (onDateChanged)="dateChanged($event)"></app-calendar-selector>

    <!-- <fuse-card class="w-full md:w-8/12">
        <app-calendar-badges
            [events]="calendarEvents"
            (dateSelected)="dateChanged($event)"
            (viewChanged)="dateChanged($event)"></app-calendar-badges>
    </fuse-card> -->

    <div
        class="flex flex-col flex-1 h-full w-full overflow-hidden sm:overflow-y-auto"
        [ngClass]="{
            'sm:mb-18': services?.length > 0
        }">
        <ng-container>
            <div
                class="bg-card flex flex-col items-start border-b p-3 dark:bg-transparent sm:flex-row sm:items-center sm:justify-between sm:py-6 md:px-6">
                <div>
                    <div class="text-3xl font-extrabold leading-none tracking-tight">
                        {{ currentDate | date: 'EEE d MMMM y' : '' : 'it-IT' | titlecase }} [#{{
                            services?.length ?? 0
                        }}]
                    </div>
                </div>
            </div>

            <div *ngIf="services?.length > 0; else noService" class="grid overflow-hidden sm:overflow-y-auto">
                <table mat-table [dataSource]="dataSource" class="mt-4">
                    <ng-container matColumnDef="status">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'General.Status' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span
                                [ngClass]="getStatusColorClass(element)"
                                class="color-box mr-3"
                                [matTooltip]="element?.status"></span>
                            <span
                                [ngClass]="getBillingStatusColorClass(element)"
                                class="color-box mr-3"
                                [matTooltip]="element?.billingStatus"></span>
                            <span
                                [ngClass]="getCommissionStatusColorClass(element)"
                                class="color-box"
                                [matTooltip]="element?.commissionStatus"></span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="tags">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.Tags' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <tag-summary [tags]="element?.tags" [viewMode]="'mini'"></tag-summary>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="date">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.Date' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.date | date: 'dd/MM/yyyy' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="serviceType">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.ServiceType' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.serviceType }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="durationType">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.DurationType' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.durationType }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="people">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.People' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.people }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="languages">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'General.Languages' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            <span
                                *ngFor="let lang of element?.languages"
                                [matTooltip]="lang"
                                class="mr-2"
                                [ngClass]="'fi fi-' + ((lang | lowercase) === 'en' ? 'gb' : (lang | lowercase))"></span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="title">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'Service.Title' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.title }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="client">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'General.Client' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.client?.fullName }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="collaborator">
                        <th mat-header-cell *matHeaderCellDef>
                            {{ 'General.Collaborator' | transloco }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.collaborator?.fullName }}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>

                    <tr
                        mat-row
                        *matRowDef="let element; columns: columnsToDisplay"
                        class="element-with-detail-row"
                        (click)="handleItem(element)"></tr>
                </table>
            </div>

            <!-- <div *ngIf="services?.length > 0; else noService" class="grid overflow-hidden sm:overflow-y-auto">
                <div
                    class="list-grid z-10 sticky top-0 grid gap-4 py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5">
                    <div class="hidden md:block">{{ 'General.Status' | transloco }}</div>
                    <div class="hidden md:block">{{ 'Service.Date' | transloco }}</div>
                    <div class="hidden md:block">
                        {{ 'Service.ServiceType' | transloco }} - {{ 'Service.DurationType' | transloco }}
                    </div>
                    <div class="hidden md:block">
                        {{ 'Service.People' | transloco }}
                    </div>
                    <div class="hidden md:block">
                        {{ 'General.Languages' | transloco }}
                    </div>
                    <div class="hidden md:block">{{ 'Service.Title' | transloco }}</div>
                    <div class="hidden md:block">{{ 'General.Client' | transloco }}</div>
                    <div class="hidden md:block">{{ 'General.Collaborator' | transloco }}</div>
                </div>
                <ng-container *ngFor="let item of services; trackBy: trackByFn">
                    <div
                        class="list-grid grid items-center gap-4 py-3 px-6 md:px-8 border-b"
                        (click)="handleItem(item)">
                        <div class="sm:block whitespace-pre-wrap">
                            <span
                                [ngClass]="getStatusColorClass(item)"
                                class="color-box mr-3"
                                [matTooltip]="item?.status"></span>
                            <span
                                [ngClass]="getBillingStatusColorClass(item)"
                                class="color-box mr-3"
                                [matTooltip]="item?.billingStatus"></span>
                            <span
                                [ngClass]="getCommissionStatusColorClass(item)"
                                class="color-box"
                                [matTooltip]="item?.commissionStatus"></span>
                        </div>

                        <div class="sm:block whitespace-pre-wrap">
                            <a [routerLink]="['/service', item?.id]" target="_blank">
                                {{ item?.date | date: 'dd/MM/yyyy' }}
                            </a>
                        </div>

                        <div class="sm:block whitespace-pre-wrap">
                            {{ item?.serviceType }} - {{ item?.durationType }}
                        </div>

                        <div class="sm:block whitespace-pre-wrap">{{ item?.people }}</div>

                        <div>
                            <div *ngFor="let lang of item?.languages">
                                <span
                                    [matTooltip]="lang"
                                    [ngClass]="
                                        'fi fi-' + ((lang | lowercase) === 'en' ? 'gb' : (lang | lowercase))
                                    "></span>
                            </div>
                        </div>

                        <div class="sm:block whitespace-pre-wrap">
                            {{ item?.title }}
                        </div>

                        <div class="sm:block whitespace-pre-wrap">
                            {{ item?.client?.fullName }}
                        </div>

                        <div class="sm:block whitespace-pre-wrap">
                            {{ item?.collaborator?.fullName }}
                        </div>
                    </div>
                    <div class="grid">
                        <ng-container *ngIf="selectedItem?.id === item.id">
                            <ng-container
                                *ngTemplateOutlet="rowDetailsTemplate; context: { $implicit: item }"></ng-container>
                        </ng-container>
                    </div>
                </ng-container>
            </div> -->
        </ng-container>

        <!-- Paginator -->
        <!-- <mat-paginator
            class="mt-auto border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
            [ngClass]="{ 'pointer-events-none': itemsLoading }"
            [length]="results?.totalCount ?? 0"
            [pageSize]="parameters?.pageSize ?? 10"
            [pageIndex]="parameters?.pageIndex ?? 0"
            [pageSizeOptions]="[5, 10, 25, 100]"
            (page)="handlePageEvent($event)"
            [showFirstLastButtons]="true"></mat-paginator> -->

        <ng-template #noService>
            <div class="z-100 flex flex-1 flex-col items-center justify-center bg-gray-100 dark:bg-transparent">
                <mat-icon class="icon-size-24" [svgIcon]="'heroicons_outline:circle-stack'"></mat-icon>
                <div class="mt-4 text-2xl font-semibold tracking-tight text-secondary">There are no data</div>
            </div>
        </ng-template>
    </div>
</div>
